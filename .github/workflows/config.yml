name: Update PR with Jira Ticket details
on: pull_request
jobs:
  update_pr_description:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v2
      - name: Extract Ticket ID from Branch Name
        id: get-jid
        run: |
          branch_name=${{ github.event.pull_request.head.ref }}
          jid=$( echo "$branch_name" | cut -d'/' -f1)
          echo "::set_output name=jira_id::$jid"
      - name : Extract Email
        id: get-user
        run: |
          user_email=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" "https://api.github.com/users/${{ github.event.pull_request.user.login }}" | jq -r '.email')
          echo "::set_output assignee=$user_email" 
      - name : actions
        id : typescript
        uses: ./
        with: 
          token: ${{ secrets.GITHUB_TOKEN }}
          jiraId: ${{ steps.get-jid.outputs.jira_id }}
          orgUrl: 'https://mock-jira-enterprise.atlassian.net'
          jiraToken: ${{ secrets.JIRA_TOKEN }}
          assigneeName: ${{ steps.get-user.outputs.user_email }}
